modelsummary(mod1,
output = "../output/margina_effects.txt")
volumes <- as.tibble(volumes)
#Regression by year
mod1 <- volumes %>% group_by(bin_20) %>%
do(tidy(feols(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics, data = .)))
mod1 <- na.omit(mod1)
# mod2 <- volumes %>% group_by(bin_20) %>%
#   do(tidy(feols(Percentile ~ Science*Religion + Science*Politics + Religion*Politics, data = .)))
modelsummary(mod1,
output = "../output/margina_effects.txt")
View(mod1)
type(mod1)
volumes <- as.tibble(volumes)
#Regression by year
mod1 <- volumes %>% group_by(bin_20) %>%
do(tidy(feols(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics, data = .)))
mod1 <- na.omit(mod1)
# mod2 <- volumes %>% group_by(bin_20) %>%
#   do(tidy(feols(Percentile ~ Science*Religion + Science*Politics + Religion*Politics, data = .)))
modelsummary(mod1,
output = "../output/marginal_effects.txt")
volumes <- as.tibble(volumes)
#Regression by year
mod1 <- volumes %>% group_by(bin_20) %>%
do(tidy(feols(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics, data = .)))
mod1 <- na.omit(mod1)
# mod2 <- volumes %>% group_by(bin_20) %>%
#   do(tidy(feols(Percentile ~ Science*Religion + Science*Politics + Religion*Politics, data = .)))
modelsummary(mod1,
statistic = NULL,
output = "../output/marginal_effects.txt")
datasummary(bin_20 ~ term, data = mod1)
datasummary(bin_20 ~ term, data = mod1,
output = 'rmarkdown')
datasummary(bin_20 ~ term, data = mod1,
output = 'markdown')
datasummary(All(bin_20) ~ term, data = mod1,
output = 'markdown')
volumes <- as.tibble(volumes)
#Regression by year
mod1 <- volumes %>% group_by(bin_20) %>%
do(tidy(feols(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics, data = .)))
mod1 <- na.omit(mod1)
# mod2 <- volumes %>% group_by(bin_20) %>%
#   do(tidy(feols(Percentile ~ Science*Religion + Science*Politics + Religion*Politics, data = .)))
modelsummary(mod1,
statistic = NULL,
output = "../output/marginal_effects.txt")
mod1 <- data.frame(mod1)
datasummary(All(bin_20) ~ term, data = mod1,
output = 'markdown')
datasummary(list(bin_20) ~ term, data = mod1,
output = 'markdown')
list(mod1$bin_20)
datasummary(list(bin_20) ~ estimate, data = mod1,
output = 'markdown')
a <- list(mod1$bin_20)
length(a)
rm(list=ls())
options(scipen=999)
library(tidyverse)
library(fixest)
library(data.table)
library(broom)
library(modelsummary)
volumes <- read.csv("../input/volumes_all_opt_percentile.csv")
volumes <- volumes[,-1] #Drops 'X' which is just the index attached by Python
years <- seq(1510,1890, by=1)
bins <- seq(1510, 1890, by = 20)
#Merge volume years to closest bin
a = data.table(Value=volumes$Year_rounded) #Extract years
a[,merge:=Value] #Give data.table something to merge on
b = data.table(Value = bins)
b[,merge:=Value]
setkeyv(a, c('merge')) #Sort for quicker merge
setkeyv(b, c('merge'))
rounded = b[a, roll='nearest'] #Merge to nearest
rounded <- distinct(rounded) #Get distinct values for easier merge to 'volumes'
# volumes <- data.table(volumes)
volumes <- merge(volumes, rounded, by.x = "Year_rounded", by.y = "merge")
#Remove unnecessary column
volumes <- volumes %>%
subset(select = -c(i.Value)) %>%
rename(bin_20 = Value)
volumes <- as.tibble(volumes)
#Regression by year
mod1 <- volumes %>% group_by(bin_20) %>%
do(tidy(feols(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics, data = .)))
#Not sure how to list results yet
mod1 <- na.omit(mod1)
modelsummary(mod1,
statistic = NULL,
output = "../output/marginal_effects.txt")
mod1 <- data.frame(mod1)
a <- list(mod1$bin_20)
datasummary(list(bin_20) ~ estimate, data = mod1,
output = 'markdown')
View(mod1)
volumes <- as.tibble(volumes)
#Regression by year
mod1 <- volumes %>% group_by(bin_20) %>%
do(tidy(feols(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics, data = .)))
#Not sure how to list results yet
mod1 <- na.omit(mod1)
# modelsummary(mod1,
#              statistic = NULL,
#              output = "../output/marginal_effects.txt")
mod1 <- data.frame(mod1)
write.table(mod1, file = '../output/marginal_effects.txt', sep = '')
# a <- list(mod1$bin_20)
#
# datasummary(list(bin_20) ~ estimate, data = mod1,
#             output = 'markdown')
?write_csv
volumes <- as.tibble(volumes)
#Regression by year
mod1 <- volumes %>% group_by(bin_20) %>%
do(tidy(feols(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics, data = .)))
#Not sure how to list results yet
mod1 <- na.omit(mod1)
# modelsummary(mod1,
#              statistic = NULL,
#              output = "../output/marginal_effects.txt")
mod1 <- data.frame(mod1)
write.csv(mod1, file = '../output/marginal_effects.txt')
# a <- list(mod1$bin_20)
#
# datasummary(list(bin_20) ~ estimate, data = mod1,
#             output = 'markdown')
volumes <- as.tibble(volumes)
#Regression by year
mod1 <- volumes %>% group_by(bin_20) %>%
do(tidy(feols(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics, data = .)))
#Not sure how to list results yet
mod1 <- na.omit(mod1)
# modelsummary(mod1,
#              statistic = NULL,
#              output = "../output/marginal_effects.txt")
mod1 <- data.frame(mod1)
write.csv(mod1, file = '../output/marginal_effects.csv')
# a <- list(mod1$bin_20)
#
# datasummary(list(bin_20) ~ estimate, data = mod1,
#             output = 'markdown')
rm(list=ls())
options(scipen=999)
library(tidyverse)
library(fixest)
library(data.table)
library(broom)
library(modelsummary)
volumes <- read.csv("../input/volumes_all_opt_percentile.csv")
volumes <- volumes[,-1] #Drops 'X' which is just the index attached by Python
years <- seq(1510,1890, by=1)
bins <- seq(1510, 1890, by = 20)
#Merge volume years to closest bin
a = data.table(Value=volumes$Year_rounded) #Extract years
a[,merge:=Value] #Give data.table something to merge on
b = data.table(Value = bins)
b[,merge:=Value]
setkeyv(a, c('merge')) #Sort for quicker merge
setkeyv(b, c('merge'))
rounded = b[a, roll='nearest'] #Merge to nearest
rounded <- distinct(rounded) #Get distinct values for easier merge to 'volumes'
# volumes <- data.table(volumes)
volumes <- merge(volumes, rounded, by.x = "Year_rounded", by.y = "merge")
#Remove unnecessary column
volumes <- volumes %>%
subset(select = -c(i.Value)) %>%
rename(bin_20 = Value)
volumes <- as.tibble(volumes)
#Regression by year
mod1 <- volumes %>% group_by(bin_20) %>%
do(tidy(feols(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics, data = .)))
#Not sure how to list results yet
mod1 <- na.omit(mod1)
# modelsummary(mod1,
#              statistic = NULL,
#              output = "../output/marginal_effects.txt")
mod1 <- data.frame(mod1)
# write.csv(mod1, file = '../output/marginal_effects.csv')
# a <- list(mod1$bin_20)
#
# datasummary(list(bin_20) ~ estimate, data = mod1,
#             output = 'markdown')
View(mod1)
volumes <- as.tibble(volumes)
#Regression by year
# mod1 <- volumes %>% group_by(bin_20) %>%
#   do(tidy(feols(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics, data = .)))
mod1 <- volumes %>% group_by(bin_20) %>%
do(x = lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics, data = .))
#Not sure how to list results yet
# mod1 <- na.omit(mod1)
# modelsummary(mod1,
#              statistic = NULL,
#              output = "../output/marginal_effects.txt")
# mod1 <- data.frame(mod1)
# write.csv(mod1, file = '../output/marginal_effects.csv')
# a <- list(mod1$bin_20)
#
# datasummary(list(bin_20) ~ estimate, data = mod1,
#             output = 'markdown')
typeof(mod1$x[[2]])
typeof(mod1$x)
z <- volumes %>%
filter(bin_20 == 1530) %>%
feols(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics, data = .)
summary(z)
library(tidyverse)
library(fixest)
library(data.table)
library(broom)
library(modelsummary)
library(msm)
delt <- deltamethod(x1 + x2, ceof(z), vcov(z))
z <- volumes %>%
filter(bin_20 == 1530) %>%
lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics, data = .)
delt <- deltamethod(x1 + x2, ceof(z), vcov(z))
?coef
z <- volumes %>%
filter(bin_20 == 1530) %>%
feols(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics, data = .)
delt <- deltamethod(x1 + x2, coef(z), vcov(z))
z <- volumes %>%
filter(bin_20 == 1530) %>%
lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics, data = .)
delt <- deltamethod(x1 + x2, coef(z), vcov(z))
y <- lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics, data = volumes)
coefs <- coef(y)
?vcov
covar <- vcov(y)
delt <- deltamethod(x1 + x2, coefs, covar)
delt <- deltamethod(Science + Politics, coefs, covar)
delt <- deltamethod(~ x1 + x2, coefs, covar)
z <- volumes %>%
filter(bin_20 == 1530) %>%
lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics, data = .)
y <- lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics, data = volumes)
coefs <- na.omit(coef(y))
covar <- vcov(y)
delt <- deltamethod(~ x1 + x2, coefs, covar)
summary(y)
z <- volumes %>%
filter(bin_20 == 1530) %>%
lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics, data = .)
y <- lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics, data = volumes)
coefs <- na.omit(coef(y))
covar <- na.omit(vcov(y))
delt <- deltamethod(~ x1 + x2, coefs, covar)
z <- volumes %>%
filter(bin_20 == 1530) %>%
lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics -Religion, data = .)
y <- lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics - religion, data = volumes)
z <- volumes %>%
filter(bin_20 == 1530) %>%
lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics -Religion, data = .)
y <- lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics - Religion, data = volumes)
coefs <- na.omit(coef(y))
covar <- na.omit(vcov(y))
delt <- deltamethod(~ x1 + x2, coefs, covar)
z <- volumes %>%
filter(bin_20 == 1530) %>%
lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics -Religion, data = .)
y <- feols(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics - Religion, data = volumes)
coefs <- na.omit(coef(y))
covar <- na.omit(vcov(y))
delt <- deltamethod(~ x1 + x2, coefs, covar)
z <- volumes %>%
filter(bin_20 == 1530) %>%
lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics -Religion, data = .)
y <- feols(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics - Religion, data = volumes)
coefs <- coef(y)
covar <- vcov(y)
delt <- deltamethod(~ x1 + x2, coefs, covar)
z <- volumes %>%
filter(bin_20 == 1530) %>%
lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics -Religion, data = .)
y <- lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics - Religion, data = volumes)
coefs <- coef(y)
covar <- vcov(y)
delt <- deltamethod(~ x1 + x2, coefs, covar)
rm(list=ls())
options(scipen=999)
library(tidyverse)
library(fixest)
library(data.table)
library(broom)
library(modelsummary)
library(msm)
volumes <- read.csv("../input/volumes_all_opt_percentile.csv")
volumes <- volumes[,-1] #Drops 'X' which is just the index attached by Python
years <- seq(1510,1890, by=1)
bins <- seq(1610, 1890, by = 20)
#Merge volume years to closest bin
a = data.table(Value=volumes$Year_rounded) #Extract years
a[,merge:=Value] #Give data.table something to merge on
b = data.table(Value = bins)
b[,merge:=Value]
setkeyv(a, c('merge')) #Sort for quicker merge
setkeyv(b, c('merge'))
rounded = b[a, roll='nearest'] #Merge to nearest
rounded <- distinct(rounded) #Get distinct values for easier merge to 'volumes'
# volumes <- data.table(volumes)
volumes <- merge(volumes, rounded, by.x = "Year_rounded", by.y = "merge")
#Remove unnecessary column
volumes <- volumes %>%
subset(select = -c(i.Value)) %>%
rename(bin_20 = Value)
volumes <- as.tibble(volumes)
#Regression by year
# mod1 <- volumes %>% group_by(bin_20) %>%
#   do(tidy(feols(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics, data = .)))
mod1 <- volumes %>% group_by(bin_20) %>%
do(x = lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics, data = .))
#Not sure how to list results yet
# mod1 <- na.omit(mod1)
# modelsummary(mod1,
#              statistic = NULL,
#              output = "../output/marginal_effects.txt")
# mod1 <- data.frame(mod1)
# write.csv(mod1, file = '../output/marginal_effects.csv')
# a <- list(mod1$bin_20)
#
# datasummary(list(bin_20) ~ estimate, data = mod1,
#             output = 'markdown')
mod1
s100 <- matrix(0, length(bins), 3)
View(s100)
colnames(s100) <- c("bin", "value", "std. error")
s100["bin"]
s100["bin",]
s100["bin",] <- bins
s100["bin"] <- bins
s100 <- matrix(0, length(bins), 3)
colnames(s100) <- c("bin", "value", "std. error")
s100[1] <- bins
View(s100)
s100[1] <- as_tibble(bins)
s100 <- as_tibble(matrix(0, length(bins), 3))
colnames(s100) <- c("bin", "value", "std. error")
s100 <- s100 %>%
mutate(bin = bins)
View(s100)
s100[1,2]
s100[2,1]
z <- volumes %>%
filter(bin_20 == 1530) %>%
lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics -Religion, data = .)
z <- volumes %>%
filter(bin_20 == 1630) %>%
lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics -Religion, data = .)
y <- lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics - Religion, data = volumes)
coefs <- coef(y)
covar <- vcov(y)
delt <- deltamethod(~ x1 + x2, coefs, covar)
coefs
coefs["Science"]
z <- volumes %>%
filter(bin_20 == 1630) %>%
lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics -Religion, data = .)
y <- lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics - Religion, data = volumes)
coefs <- coef(y)
covar <- vcov(y)
delt <- deltamethod(~ x1, coefs, covar)
summary(y)
s100 <- as_tibble(matrix(0, length(bins), 3))
colnames(s100) <- c("bin", "value", "std. error")
s100 <- s100 %>%
mutate(bin = bins)
for (i in 1:length(bins)){
betas <- coef(x[[i]])
covar <- vcov(x[[i]])
s100[i,2] <- betas["Science"]
s100[i,3] <- deltamethod(~ x2, betas, covar)
}
for (i in 1:length(bins)){
betas <- coef(mod1$x[[i]])
covar <- vcov(mod1$x[[i]])
s100[i,2] <- betas["Science"]
s100[i,3] <- deltamethod(~ x2, betas, covar)
}
View(s100)
mod1 <- volumes %>% group_by(bin_20) %>%
do(x = lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics - Religion, data = .))
for (i in 1:length(bins)){
betas <- coef(mod1$x[[i]])
covar <- vcov(mod1$x[[i]])
s100[i,2] <- betas["Science"]
s100[i,3] <- deltamethod(~ x2, betas, covar)
}
View(s100)
coefs["Science:Religion"]
s100 <- as_tibble(matrix(0, length(bins), 3))
colnames(s100) <- c("bin", "value", "std. error")
s100 <- s100 %>%
mutate(bin = bins)
s50p50 <- as_tibble(matrix(0, length(bins), 3))
colnames(s50p50) <- c("bin", "value", "std. error")
s50p50 <- s50p50 %>%
mutate(bin = bins)
for (i in 1:length(bins)){
betas <- coef(mod1$x[[i]])
covar <- vcov(mod1$x[[i]])
s100[i,2] <- betas["Science"]
s100[i,3] <- deltamethod(~ x2, betas, covar)
s50p50[i,2] <- betas["Science"]*.5 + betas["Science:Religion"]*.5
s50p50[i,3] <- deltamethod(~ x2*0.5 + x4*0.5, betas, covar)
}
View(s50p50)
volumes <- as.tibble(volumes)
#Regression by year
# mod1 <- volumes %>% group_by(bin_20) %>%
#   do(tidy(feols(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics, data = .)))
mod1 <- volumes %>% group_by(bin_20) %>%
do(x = lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics - Religion, data = .))
#Make empty dataframes
s100 <- as_tibble(matrix(0, length(bins), 3))
colnames(s100) <- c("bin", "value", "std. error")
s100 <- s100 %>%
mutate(bin = bins)
s50p50 <- as_tibble(matrix(0, length(bins), 3))
colnames(s50p50) <- c("bin", "value", "std. error")
s50p50 <- s50p50 %>%
mutate(bin = bins)
s50r50 <- as_tibble(matrix(0, length(bins), 3))
colnames(s50r50) <- c("bin", "value", "std. error")
s50r50 <- s50r50 %>%
mutate(bin = bins)
thirds <- as_tibble(matrix(0, length(bins), 3))
colnames(thirds) <- c("bin", "value", "std. error")
thirds <- thirds %>%
mutate(bin = bins)
for (i in 1:length(bins)){
betas <- coef(mod1$x[[i]])
covar <- vcov(mod1$x[[i]])
s100[i,2] <- betas["Science"]
s100[i,3] <- deltamethod(~ x2, betas, covar)
s50p50[i,2] <- betas["Science"]*0.5 + betas["Science:Religion"]*0.5
s50p50[i,3] <- deltamethod(~ x2*0.5 + x4*0.5, betas, covar)
s50r50[i,2] <- betas["Science"]*0.5 + betas["Science:Politics"]*0.5
s50r50[i,3] <- deltamethod(~ x2*0.5 + x5*0.5, betas, covar)
thirds[i,2] <- betas["Science"]*(1/3) + betas["Science:Religion"]*(1/3) + betas["Science:Politics"]*(1/3)
thirds[i,3] <- deltamethod(~ x2*(1/3) + x4*(1/3) + x5*(1/3), betas, covar)
}
#Not sure how to list results yet
# mod1 <- na.omit(mod1)
# modelsummary(mod1,
#              statistic = NULL,
#              output = "../output/marginal_effects.txt")
# mod1 <- data.frame(mod1)
# write.csv(mod1, file = '../output/marginal_effects.csv')
# a <- list(mod1$bin_20)
#
# datasummary(list(bin_20) ~ estimate, data = mod1,
#             output = 'markdown')
View(thirds)
View(thirds)
View(s100)
View(s50p50)
volumes <- as.tibble(volumes)
#Regression by year
# mod1 <- volumes %>% group_by(bin_20) %>%
#   do(tidy(feols(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics, data = .)))
mod1 <- volumes %>% group_by(bin_20) %>%
do(x = lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics - Religion, data = .))
#Make empty dataframes
s100 <- as_tibble(matrix(0, length(bins), 3))
colnames(s100) <- c("bin", "value", "std. error")
s100 <- s100 %>%
mutate(bin = bins)
s50p50 <- as_tibble(matrix(0, length(bins), 3))
colnames(s50p50) <- c("bin", "value", "std. error")
s50p50 <- s50p50 %>%
mutate(bin = bins)
s50r50 <- as_tibble(matrix(0, length(bins), 3))
colnames(s50r50) <- c("bin", "value", "std. error")
s50r50 <- s50r50 %>%
mutate(bin = bins)
thirds <- as_tibble(matrix(0, length(bins), 3))
colnames(thirds) <- c("bin", "value", "std. error")
thirds <- thirds %>%
mutate(bin = bins)
for (i in 1:length(bins)){
betas <- coef(mod1$x[[i]])
covar <- vcov(mod1$x[[i]])
s100[i,2] <- betas["Science"]
s100[i,3] <- deltamethod(~ x2, betas, covar)
s50r50[i,2] <- betas["Science"]*0.5 + betas["Science:Religion"]*0.5
s50r50[i,3] <- deltamethod(~ x2*0.5 + x4*0.5, betas, covar)
s50p50[i,2] <- betas["Science"]*0.5 + betas["Science:Politics"]*0.5
s50p50[i,3] <- deltamethod(~ x2*0.5 + x5*0.5, betas, covar)
thirds[i,2] <- betas["Science"]*(1/3) + betas["Science:Religion"]*(1/3) + betas["Science:Politics"]*(1/3)
thirds[i,3] <- deltamethod(~ x2*(1/3) + x4*(1/3) + x5*(1/3), betas, covar)
}
#Not sure how to list results yet
# mod1 <- na.omit(mod1)
# modelsummary(mod1,
#              statistic = NULL,
#              output = "../output/marginal_effects.txt")
# mod1 <- data.frame(mod1)
# write.csv(mod1, file = '../output/marginal_effects.csv')
# a <- list(mod1$bin_20)
#
# datasummary(list(bin_20) ~ estimate, data = mod1,
#             output = 'markdown')
View(s50p50)
View(s50r50)
View(thirds)
View(s100)
