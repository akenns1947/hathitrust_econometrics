names(pol_year) <- gsub("x", "p", names(pol_year), fixed=TRUE)
# sci_year %>% rename_with( ~ paste0())
df <- cbind(volumes, year_dummies, sci_year, pol_year)
model <- lm(Percentile ~. - Year_rounded - Optimism - Religion, data = df)
summary(model)
coef(model)
results <- coef(model)
results <- as.tibble(coef(model))
results <- as_tibble(coef(model))
View(results)
rownames(model)
results <- as_tibble(coef(summary(model, complete=TRUE)))
View(results)
rownames(results)
library(broom)
results <- tidy(model)
View(results)
results["Science"]
results["Science", ]
rownames(results) <- results$term
View(results)
results["Science", ]
results["Science":"x1550", ]
results <- tidy(model)
?subset
?substr
a1 <- results %>% filter(term, term == "(Intercept)")
a1 <- results %>% filter(term == "(Intercept)")
View(a1)
a1["estimate"]
a1$estimate
a4 <- resutls %>% filter(substr(term, 1, 1) == "p")
a4 <- results %>% filter(substr(term, 1, 1) == "p")
View(a4)
a1 <- results %>% filter(term == "(Intercept)")
a2 <- results %>% filter(term == "Politics")
a3 <- results %>% filter(term == "Science")
a4 <- results %>% filter(substr(term, 1, 1) == "p")
a5 <- results %>% filter(substr(term, 1, 1) == "s")
a6 <- results %>% filter(substr(term, 1, 1) == "x")
a1 <- rep(a1$estimate, length(a4))
a2 <- rep(a2$estimate, length(a4))
a3 <- rep(a3$estimate, length(a4))
test <- cbind(a1,a2,a3)
test <- as_tibble(cbind(a1,a2,a3))
View(test)
a1 <- rep(a1$estimate, nrows(a4))
a1 <- results %>% filter(term == "(Intercept)")
a2 <- results %>% filter(term == "Politics")
a3 <- results %>% filter(term == "Science")
a4 <- results %>% filter(substr(term, 1, 1) == "p")
a5 <- results %>% filter(substr(term, 1, 1) == "s")
a6 <- results %>% filter(substr(term, 1, 1) == "x")
a1 <- rep(a1$estimate, nrows(a4))
a1 <- rep(a1$estimate, nrow(a4))
a1 <- results %>% filter(term == "(Intercept)")
a2 <- results %>% filter(term == "Politics")
a3 <- results %>% filter(term == "Science")
a4 <- results %>% filter(substr(term, 1, 1) == "p")
a5 <- results %>% filter(substr(term, 1, 1) == "s")
a6 <- results %>% filter(substr(term, 1, 1) == "x")
a1 <- rep(a1$estimate, nrow(a4))
a2 <- rep(a2$estimate, nrow(a4))
a3 <- rep(a3$estimate, nrow(a4))
test <- as_tibble(cbind(a1,a2,a3))
test <- as_tibble(cbind(a1, a2, a3, a4, a5, a6))
test <- as_tibble(cbind(a1, a2, a3, a4$estimate, a5$estimate, a6$estimate))
View(test)
a1 <- results %>% filter(term == "(Intercept)") %>% pull(estimate)
a1 <- results %>% filter(term == "(Intercept)") %>% pull(estimate)
a2 <- results %>% filter(term == "Politics") %>% pull(estimate)
a3 <- results %>% filter(term == "Science") %>% pull(estimate)
a4 <- results %>% filter(substr(term, 1, 1) == "p") %>% pull(estimate)
a5 <- results %>% filter(substr(term, 1, 1) == "s") %>% pull(estimate)
a6 <- results %>% filter(substr(term, 1, 1) == "x") %>% pull(estimate)
a1 <- rep(a1, nrow(a4))
a1 <- rep(a1, length(a4))
a1 <- results %>% filter(term == "(Intercept)") %>% pull(estimate)
a2 <- results %>% filter(term == "Politics") %>% pull(estimate)
a3 <- results %>% filter(term == "Science") %>% pull(estimate)
a4 <- results %>% filter(substr(term, 1, 1) == "p") %>% pull(estimate)
a5 <- results %>% filter(substr(term, 1, 1) == "s") %>% pull(estimate)
a6 <- results %>% filter(substr(term, 1, 1) == "x") %>% pull(estimate)
a1 <- rep(a1, length(a4))
a2 <- rep(a2, length(a4))
a3 <- rep(a3, length(a4))
test <- as_tibble(cbind(a1, a2, a3, a4, a5, a6))
View(test)
rm(list=ls())
options(scipen=999)
library(tidyverse)
volumes <- read.csv("../input/volumes_all_opt_percentile.csv")
volumes <- volumes[,-1] #Drops 'X' which is just the index attached by Python
years <- seq(1510,1890, by=1)
#Create empty data frame with row dimension same as 'volumes', column dimension 'years'
#Column names are
year_dummies <- data.frame(matrix(0, nrow = nrow(volumes), ncol = length(years),
dimnames = list(NULL, paste0("x", years[1]:years[length(years)]))))
#Populate with dummies
for (i in 1:length(years)){
year <- years[i]
year_dummies[i] <- ifelse(volumes$Year_rounded >= (year - 10) & volumes$Year_rounded <= (year + 10), 1, 0)
}
sci_year <- volumes$Science*year_dummies
pol_year <- volumes$Politics*year_dummies
#Rename column names, regression cannot have repeated col names
names(sci_year) <- gsub("x", "s", names(sci_year), fixed=TRUE)
names(pol_year) <- gsub("x", "p", names(pol_year), fixed=TRUE)
# sci_year %>% rename_with( ~ paste0())
df <- cbind(volumes, year_dummies, sci_year, pol_year)
model <- lm(Percentile ~. - Year_rounded - Optimism - Religion, data = df)
summary(model)
library(broom)
results <- tidy(model)
a1 <- results %>% filter(term == "(Intercept)") %>% pull(estimate)
a2 <- results %>% filter(term == "Politics") %>% pull(estimate)
a3 <- results %>% filter(term == "Science") %>% pull(estimate)
a4 <- results %>% filter(substr(term, 1, 1) == "p") %>% pull(estimate)
a5 <- results %>% filter(substr(term, 1, 1) == "s") %>% pull(estimate)
a6 <- results %>% filter(substr(term, 1, 1) == "x") %>% pull(estimate)
a1 <- rep(a1, length(a4))
a2 <- rep(a2, length(a4))
a3 <- rep(a3, length(a4))
test <- as_tibble(cbind(a1, a2, a3, a4, a5, a6))
# results <- as_tibble(c(coef(model,  )))
# results <- as_tibble(coef(summary(model, complete=TRUE)))
#
# library(broom)
# results <- tidy(model)
#
# a1 <- results %>% filter(term == "(Intercept)")
# a2 <- results %>% filter(term == "Politics")
# a3 <- results %>% filter(term == "Science")
# a4 <- results %>% filter(substr(term, 1, 1) == "p")
# a5 <- results %>% filter(substr(term, 1, 1) == "s")
# a6 <- results %>% filter(substr(term, 1, 1) == "x")
#
# fit <- lm(Percentile ~ x1510, data=df)
# summary(fit)
# df %>% group_by(x1513) %>%
#   tally()
View(test)
cffts <- as_tibble(cbind(a1, a2, a3, a4, a5, a6))
cffts <- cffts %>%
add_column(Year = years)
View(cffts)
ggplot(cffts, aes(x = Year)) +
geom_line(aes(y = a1 + a6))
ggplot(cffts, aes(x = Year)) +
geom_line(aes(y = a1 + a6), color = 'red')
ggplot(cffts, aes(x = Year)) +
geom_line(aes(y = a1 + a6), color = 'religion') +
geom_line(aes(y = a1 + a2 + a4 + a6), color = 'politics') +
geom_line(aes(y = a1 + a3 + a5 + a6), color = 'science') +
scale_color_manual(name = "Legend", values = c('religion' = 'blue', 'politics' = 'red', 'science' = 'green'))
ggplot(cffts, aes(x = Year)) +
geom_line(aes(y = a1 + a6), colour = 'religion') +
geom_line(aes(y = a1 + a2 + a4 + a6), colour = 'politics') +
geom_line(aes(y = a1 + a3 + a5 + a6), colour = 'science') +
scale_color_manual(name = "Legend", values = c('religion' = 'blue', 'politics' = 'red', 'science' = 'green'))
ggplot(cffts, aes(x = Year)) +
geom_line(aes(y = a1 + a6, colour = 'religion')) +
geom_line(aes(y = a1 + a2 + a4 + a6, colour = 'politics')) +
geom_line(aes(y = a1 + a3 + a5 + a6, colour = 'science')) +
scale_color_manual(name = "Legend", values = c('religion' = 'blue', 'politics' = 'red', 'science' = 'green'))
ggplot(cffts, aes(x = (Year >= 1700))) +
geom_line(aes(y = a1 + a6, colour = 'religion')) +
geom_line(aes(y = a1 + a2 + a4 + a6, colour = 'politics')) +
geom_line(aes(y = a1 + a3 + a5 + a6, colour = 'science')) +
scale_color_manual(name = "Legend", values = c('religion' = 'blue', 'politics' = 'red', 'science' = 'green'))
cffts$Year[1700]
cffts$Year["1700":"1800"]
cffts$Year[1]
cffts$Year['1500']
ggplot(cffts, aes(x = Year %in% seq(1700,1890,1))) +
geom_line(aes(y = a1 + a6, colour = 'religion')) +
geom_line(aes(y = a1 + a2 + a4 + a6, colour = 'politics')) +
geom_line(aes(y = a1 + a3 + a5 + a6, colour = 'science')) +
scale_color_manual(name = "Legend", values = c('religion' = 'blue', 'politics' = 'red', 'science' = 'green'))
ggplot(subset(cffts, Year %in% seq(1700,1890,1)), aes(x = Year)) +
geom_line(aes(y = a1 + a6, colour = 'religion')) +
geom_line(aes(y = a1 + a2 + a4 + a6, colour = 'politics')) +
geom_line(aes(y = a1 + a3 + a5 + a6, colour = 'science')) +
scale_color_manual(name = "Legend", values = c('religion' = 'blue', 'politics' = 'red', 'science' = 'green'))
View(df)
rm(list=ls())
options(scipen=999)
library(tidyverse)
volumes <- read.csv("../input/volumes_all_opt_percentile.csv")
volumes <- volumes[,-1] #Drops 'X' which is just the index attached by Python
years <- seq(1510,1890, by=1)
#Create empty data frame with row dimension same as 'volumes', column dimension 'years'
#Column names are
year_dummies <- data.frame(matrix(0, nrow = nrow(volumes), ncol = length(years),
dimnames = list(NULL, paste0("x", years[1]:years[length(years)]))))
#Populate with dummies
for (i in 1:length(years)){
year <- years[i]
year_dummies[i] <- ifelse(volumes$Year_rounded >= (year - 10) & volumes$Year_rounded <= (year + 10), 1, 0)
}
sci_year <- volumes$Science*year_dummies
pol_year <- volumes$Politics*year_dummies
#Rename column names, regression cannot have repeated col names
names(sci_year) <- gsub("x", "s", names(sci_year), fixed=TRUE)
names(pol_year) <- gsub("x", "p", names(pol_year), fixed=TRUE)
# sci_year %>% rename_with( ~ paste0())
df <- cbind(volumes, year_dummies, sci_year, pol_year)
#Choose which year to omit
a <- 1800
reg_omit <- c("Year_rounded", "Optimism", "Religion", paste0("x", a), paste0("s", a), paste0("p", a))
# model <- lm(Percentile ~. - Year_rounded - Optimism - Religion - x1800 - s1800 - p1800, data = df)
# model <- lm(Percentile ~. - Year_rounded - Optimism - Religion - b, data = df)
model <- lm(Percentile ~., data = df[, !(colnames(df) %in% reg_omit)])
summary(model)
library(broom)
results <- tidy(model)
a1 <- results %>% filter(term == "(Intercept)") %>% pull(estimate)
a2 <- results %>% filter(term == "Politics") %>% pull(estimate)
a3 <- results %>% filter(term == "Science") %>% pull(estimate)
a4 <- results %>% filter(substr(term, 1, 1) == "p") %>% pull(estimate)
a5 <- results %>% filter(substr(term, 1, 1) == "s") %>% pull(estimate)
a6 <- results %>% filter(substr(term, 1, 1) == "x") %>% pull(estimate)
a1 <- rep(a1, length(a4))
a2 <- rep(a2, length(a4))
a3 <- rep(a3, length(a4))
cffts <- as_tibble(cbind(a1, a2, a3, a4, a5, a6))
cffts <- cffts %>%
add_column(Year = years[years != a])
ggplot(cffts, aes(x = Year)) +
geom_line(aes(y = a1 + a6, colour = 'religion')) +
geom_line(aes(y = a1 + a2 + a4 + a6, colour = 'politics')) +
geom_line(aes(y = a1 + a3 + a5 + a6, colour = 'science')) +
scale_color_manual(name = "Legend", values = c('religion' = 'blue', 'politics' = 'red', 'science' = 'green'))
ggplot(subset(cffts, Year %in% seq(1700,1890,1)), aes(x = Year)) +
geom_line(aes(y = a1 + a6, colour = 'religion')) +
geom_line(aes(y = a1 + a2 + a4 + a6, colour = 'politics')) +
geom_line(aes(y = a1 + a3 + a5 + a6, colour = 'science')) +
scale_color_manual(name = "Legend", values = c('religion' = 'blue', 'politics' = 'red', 'science' = 'green'))
# results <- as_tibble(c(coef(model,  )))
# results <- as_tibble(coef(summary(model, complete=TRUE)))
#
# library(broom)
# results <- tidy(model)
#
# a1 <- results %>% filter(term == "(Intercept)")
# a2 <- results %>% filter(term == "Politics")
# a3 <- results %>% filter(term == "Science")
# a4 <- results %>% filter(substr(term, 1, 1) == "p")
# a5 <- results %>% filter(substr(term, 1, 1) == "s")
# a6 <- results %>% filter(substr(term, 1, 1) == "x")
#
# fit <- lm(Percentile ~ x1510, data=df)
# summary(fit)
# df %>% group_by(x1513) %>%
#   tally()
mod <- lm(Percentile ~ Politics + Science + Politics*factor(Year_rounded) + Science*factor(Year_rounded) + factor(Year_rounded), data = df)
summary(mod)
res <- tidy(mod)
View(res)
?substr
b1 <- res %>% filter(term == "(Intercept)") %>% pull(estimate)
b2 <- res %>% filter(term == "Politics") %>% pull(estimate)
b3 <- res %>% filter(term == "Science") %>% pull(estimate)
b4 <- res %>% filter(substr(term, 1, 9) == "Politics:") %>% pull(estimate)
b5 <- res %>% filter(substr(term, 1, 8) == "Science:") %>% pull(estimate)
b6 <- res %>% filter(substr(term, 1, 6) == "factor") %>% pull(estimate)
b1 <- rep(b1, length(b4))
b2 <- rep(b2, length(b4))
b3 <- rep(b3, length(b4))
betas <- cbind(b1, b2, b3, b4, b5, b6)
betas <- as.tibble(cbind(b1, b2, b3, b4, b5, b6))
betas <- as_tibble(cbind(b1, b2, b3, b4, b5, b6))
years <- res %>% filter(substr(term, 1, 6) == "factor") %>% substr(term, nchar(term)-4, nchar(term))
years <- res %>% filter(substr(term, 1, 6) == "factor") %>% substr(term, 1, 6)
years <- res %>% filter(substr(term, 1, 6) == "factor") %>% substr(1, 6)
y <- res %>% filter(substr(term, 1, 6) == "factor") %>% substr(nchar() - 4, nchar())
y <- res %>% filter(substr(term, 1, 6) == "factor") %>% substr(nchar(.) - 4, nchar(.))
y <- res %>% filter(substr(term, 1, 6) == "factor") %>% pull(substr(nchar(.) - 4, nchar(.)))
y <- res %>% filter(substr(term, 1, 6) == "factor") %>% pull(term)
y <- substr(y, nchar(y)-4, nchar(y))
y <- substr(y, nchar(y)-3, nchar(y))
y <- as.numeric(y)
b1 <- res %>% filter(term == "(Intercept)") %>% pull(estimate)
b2 <- res %>% filter(term == "Politics") %>% pull(estimate)
b3 <- res %>% filter(term == "Science") %>% pull(estimate)
b4 <- res %>% filter(substr(term, 1, 9) == "Politics:") %>% pull(estimate)
b5 <- res %>% filter(substr(term, 1, 8) == "Science:") %>% pull(estimate)
b6 <- res %>% filter(substr(term, 1, 6) == "factor") %>% pull(estimate)
y <- res %>% filter(substr(term, 1, 6) == "factor") %>% pull(term)
y <- substr(y, nchar(y)-3, nchar(y))
y <- as.numeric(y)
b1 <- rep(b1, length(b4))
b2 <- rep(b2, length(b4))
b3 <- rep(b3, length(b4))
betas <- as_tibble(cbind(b1, b2, b3, b4, b5, b6, y))
View(betas)
?range
range(df$Year_rounded)
b1 <- res %>% filter(term == "(Intercept)") %>% pull(estimate)
b2 <- res %>% filter(term == "Politics") %>% pull(estimate)
b3 <- res %>% filter(term == "Science") %>% pull(estimate)
b4 <- res %>% filter(substr(term, 1, 9) == "Politics:") %>% pull(estimate)
b5 <- res %>% filter(substr(term, 1, 8) == "Science:") %>% pull(estimate)
b6 <- res %>% filter(substr(term, 1, 6) == "factor") %>% pull(estimate)
yr <- res %>% filter(substr(term, 1, 6) == "factor") %>% pull(term)
yr <- substr(yr, nchar(yr)-3, nchar(yr))
yr <- as.numeric(yr)
b1 <- rep(b1, length(b4))
b2 <- rep(b2, length(b4))
b3 <- rep(b3, length(b4))
betas <- as_tibble(cbind(b1, b2, b3, b4, b5, b6, yr))
ggplot(subset(betas, yr %in% seq(1700,1890,1)), aes(x = yr)) +
geom_line(aes(y = b1 + b6, colour = 'religion')) +
geom_line(aes(y = b1 + b2 + b4 + b6, colour = 'politics')) +
geom_line(aes(y = b1 + b3 + b5 + b6, colour = 'science')) +
scale_color_manual(name = "Legend", values = c('religion' = 'blue', 'politics' = 'red', 'science' = 'green'))
ggplot(subset(betas, yr %in% seq(1500,1899,1)), aes(x = yr)) +
geom_line(aes(y = b1 + b6, colour = 'religion')) +
geom_line(aes(y = b1 + b2 + b4 + b6, colour = 'politics')) +
geom_line(aes(y = b1 + b3 + b5 + b6, colour = 'science')) +
scale_color_manual(name = "Legend", values = c('religion' = 'blue', 'politics' = 'red', 'science' = 'green'))
ggplot(subset(betas, yr %in% seq(1700,1890,1)), aes(x = yr)) +
geom_line(aes(y = b1 + b6, colour = 'religion')) +
geom_line(aes(y = b1 + b4 + b6, colour = 'politics')) +
geom_line(aes(y = b1 + b5 + b6, colour = 'science')) +
scale_color_manual(name = "Legend", values = c('religion' = 'blue', 'politics' = 'red', 'science' = 'green'))
ggplot(subset(betas, yr %in% seq(1700,1890,1)), aes(x = yr)) +
geom_line(aes(y = b1 + b6, colour = 'religion')) +
geom_line(aes(y = b1 + b2 + b4 + b6, colour = 'politics')) +
geom_line(aes(y = b1 + b3 + b5 + b6, colour = 'science')) +
scale_color_manual(name = "Legend", values = c('religion' = 'blue', 'politics' = 'red', 'science' = 'green'))
ggplot(cffts, aes(x = Year)) +
geom_line(aes(y = a1 + a6, colour = 'religion')) +
geom_line(aes(y = a1 + a2 + a4 + a6, colour = 'politics')) +
geom_line(aes(y = a1 + a3 + a5 + a6, colour = 'science')) +
scale_color_manual(name = "Legend", values = c('religion' = 'blue', 'politics' = 'red', 'science' = 'green'))
ggsave("../output/results_full_binned")
ggplot(cffts, aes(x = Year)) +
geom_line(aes(y = a1 + a6, colour = 'religion')) +
geom_line(aes(y = a1 + a2 + a4 + a6, colour = 'politics')) +
geom_line(aes(y = a1 + a3 + a5 + a6, colour = 'science')) +
scale_color_manual(name = "Legend", values = c('religion' = 'blue', 'politics' = 'red', 'science' = 'green'))
ggsave("../output/results_full_binned.png")
?labs
ggplot(cffts, aes(x = Year)) +
geom_line(aes(y = a1 + a6, colour = 'religion')) +
geom_line(aes(y = a1 + a2 + a4 + a6, colour = 'politics')) +
geom_line(aes(y = a1 + a3 + a5 + a6, colour = 'science')) +
scale_color_manual(name = "Legend", values = c('religion' = 'blue', 'politics' = 'red', 'science' = 'green'))+
labs(x = "Year", y = "Value")
ggsave("../output/results_full_binned.png")
ggplot(subset(cffts, Year %in% seq(1700,1890,1)), aes(x = Year)) +
geom_line(aes(y = a1 + a6, colour = 'religion')) +
geom_line(aes(y = a1 + a2 + a4 + a6, colour = 'politics')) +
geom_line(aes(y = a1 + a3 + a5 + a6, colour = 'science')) +
scale_color_manual(name = "Legend", values = c('religion' = 'blue', 'politics' = 'red', 'science' = 'green'))+
labs(title = "20-year bins", x = "Year", y = "Value")
ggsave("../output/results_1700_binned.png")
ggplot(cffts, aes(x = Year)) +
geom_line(aes(y = a1 + a6, colour = 'religion')) +
geom_line(aes(y = a1 + a2 + a4 + a6, colour = 'politics')) +
geom_line(aes(y = a1 + a3 + a5 + a6, colour = 'science')) +
scale_color_manual(name = "Legend", values = c('religion' = 'blue', 'politics' = 'red', 'science' = 'green'))+
labs(title = "20-year bins", x = "Year", y = "Value")
ggsave("../output/results_full_binned.png")
ggplot(subset(betas, yr %in% seq(1500,1900,1)), aes(x = yr)) +
geom_line(aes(y = b1 + b6, colour = 'religion')) +
geom_line(aes(y = b1 + b2 + b4 + b6, colour = 'politics')) +
geom_line(aes(y = b1 + b3 + b5 + b6, colour = 'science')) +
scale_color_manual(name = "Legend", values = c('religion' = 'blue', 'politics' = 'red', 'science' = 'green'))+
labs(title = "Single-year", x = "Year", y = "Values")
ggplot(subset(betas, yr %in% seq(1700,1890,1)), aes(x = yr)) +
geom_line(aes(y = b1 + b6, colour = 'religion')) +
geom_line(aes(y = b1 + b2 + b4 + b6, colour = 'politics')) +
geom_line(aes(y = b1 + b3 + b5 + b6, colour = 'science')) +
scale_color_manual(name = "Legend", values = c('religion' = 'blue', 'politics' = 'red', 'science' = 'green'))+
labs(title = "Single-year", x = "Year", y = "Values")
ggsave("../output/results_1700_single.png")
ggplot(subset(betas, yr %in% seq(1500,1900,1)), aes(x = yr)) +
geom_line(aes(y = b1 + b6, colour = 'religion')) +
geom_line(aes(y = b1 + b2 + b4 + b6, colour = 'politics')) +
geom_line(aes(y = b1 + b3 + b5 + b6, colour = 'science')) +
scale_color_manual(name = "Legend", values = c('religion' = 'blue', 'politics' = 'red', 'science' = 'green'))+
labs(title = "Single-year", x = "Year", y = "Values")
ggsave("../output/results_full_single.png")
mod <- lm(Optimism ~ Politics + Science + Politics*factor(Year_rounded) + Science*factor(Year_rounded) + factor(Year_rounded), data = df)
summary(mod)
res <- tidy(mod)
b1 <- res %>% filter(term == "(Intercept)") %>% pull(estimate)
b2 <- res %>% filter(term == "Politics") %>% pull(estimate)
b3 <- res %>% filter(term == "Science") %>% pull(estimate)
b4 <- res %>% filter(substr(term, 1, 9) == "Politics:") %>% pull(estimate)
b5 <- res %>% filter(substr(term, 1, 8) == "Science:") %>% pull(estimate)
b6 <- res %>% filter(substr(term, 1, 6) == "factor") %>% pull(estimate)
yr <- res %>% filter(substr(term, 1, 6) == "factor") %>% pull(term)
yr <- substr(yr, nchar(yr)-3, nchar(yr))
yr <- as.numeric(yr)
b1 <- rep(b1, length(b4))
b2 <- rep(b2, length(b4))
b3 <- rep(b3, length(b4))
betas <- as_tibble(cbind(b1, b2, b3, b4, b5, b6, yr))
ggplot(subset(betas, yr %in% seq(1700,1890,1)), aes(x = yr)) +
geom_line(aes(y = b1 + b6, colour = 'religion')) +
geom_line(aes(y = b1 + b2 + b4 + b6, colour = 'politics')) +
geom_line(aes(y = b1 + b3 + b5 + b6, colour = 'science')) +
scale_color_manual(name = "Legend", values = c('religion' = 'blue', 'politics' = 'red', 'science' = 'green'))+
labs(title = "Single-year", x = "Year", y = "Values")
rm(list=ls())
options(scipen=999)
library(tidyverse)
volumes <- read.csv("../input/volumes_all_opt_percentile.csv")
volumes <- volumes[,-1] #Drops 'X' which is just the index attached by Python
years <- seq(1510,1890, by=1)
#Create empty data frame with row dimension same as 'volumes', column dimension 'years'
#Column names are
year_dummies <- data.frame(matrix(0, nrow = nrow(volumes), ncol = length(years),
dimnames = list(NULL, paste0("x", years[1]:years[length(years)]))))
#Populate with dummies
for (i in 1:length(years)){
year <- years[i]
year_dummies[i] <- ifelse(volumes$Year_rounded >= (year - 10) & volumes$Year_rounded <= (year + 10), 1, 0)
}
sci_year <- volumes$Science*year_dummies
pol_year <- volumes$Politics*year_dummies
#Rename column names, regression cannot have repeated col names
names(sci_year) <- gsub("x", "s", names(sci_year), fixed=TRUE)
names(pol_year) <- gsub("x", "p", names(pol_year), fixed=TRUE)
# sci_year %>% rename_with( ~ paste0())
df <- cbind(volumes, year_dummies, sci_year, pol_year)
#Choose which year to omit
a <- 1800
reg_omit <- c("Year_rounded", "Optimism", "Religion", paste0("x", a), paste0("s", a), paste0("p", a))
# model <- lm(Percentile ~. - Year_rounded - Optimism - Religion - x1800 - s1800 - p1800, data = df)
# model <- lm(Percentile ~. - Year_rounded - Optimism - Religion - b, data = df)
model <- lm(Percentile ~., data = df[, !(colnames(df) %in% reg_omit)])
summary(model)
library(broom)
results <- tidy(model)
a1 <- results %>% filter(term == "(Intercept)") %>% pull(estimate)
a2 <- results %>% filter(term == "Politics") %>% pull(estimate)
a3 <- results %>% filter(term == "Science") %>% pull(estimate)
a4 <- results %>% filter(substr(term, 1, 1) == "p") %>% pull(estimate)
a5 <- results %>% filter(substr(term, 1, 1) == "s") %>% pull(estimate)
a6 <- results %>% filter(substr(term, 1, 1) == "x") %>% pull(estimate)
a1 <- rep(a1, length(a4))
a2 <- rep(a2, length(a4))
a3 <- rep(a3, length(a4))
cffts <- as_tibble(cbind(a1, a2, a3, a4, a5, a6))
cffts <- cffts %>%
add_column(Year = years[years != a])
ggplot(cffts, aes(x = Year)) +
geom_line(aes(y = a1 + a6, colour = 'religion')) +
geom_line(aes(y = a1 + a2 + a4 + a6, colour = 'politics')) +
geom_line(aes(y = a1 + a3 + a5 + a6, colour = 'science')) +
scale_color_manual(name = "Legend", values = c('religion' = 'blue', 'politics' = 'red', 'science' = 'green'))+
labs(title = "20-year bins", x = "Year", y = "Value")
ggsave("../output/results_full_binned.png")
ggplot(subset(cffts, Year %in% seq(1700,1890,1)), aes(x = Year)) +
geom_line(aes(y = a1 + a6, colour = 'religion')) +
geom_line(aes(y = a1 + a2 + a4 + a6, colour = 'politics')) +
geom_line(aes(y = a1 + a3 + a5 + a6, colour = 'science')) +
scale_color_manual(name = "Legend", values = c('religion' = 'blue', 'politics' = 'red', 'science' = 'green'))+
labs(title = "20-year bins", x = "Year", y = "Value")
ggsave("../output/results_1700_binned.png")
mod <- lm(Percentile ~ Politics + Science + Politics*factor(Year_rounded) + Science*factor(Year_rounded) + factor(Year_rounded), data = df)
summary(mod)
res <- tidy(mod)
b1 <- res %>% filter(term == "(Intercept)") %>% pull(estimate)
b2 <- res %>% filter(term == "Politics") %>% pull(estimate)
b3 <- res %>% filter(term == "Science") %>% pull(estimate)
b4 <- res %>% filter(substr(term, 1, 9) == "Politics:") %>% pull(estimate)
b5 <- res %>% filter(substr(term, 1, 8) == "Science:") %>% pull(estimate)
b6 <- res %>% filter(substr(term, 1, 6) == "factor") %>% pull(estimate)
yr <- res %>% filter(substr(term, 1, 6) == "factor") %>% pull(term)
yr <- substr(yr, nchar(yr)-3, nchar(yr))
yr <- as.numeric(yr)
b1 <- rep(b1, length(b4))
b2 <- rep(b2, length(b4))
b3 <- rep(b3, length(b4))
betas <- as_tibble(cbind(b1, b2, b3, b4, b5, b6, yr))
ggplot(subset(betas, yr %in% seq(1700,1890,1)), aes(x = yr)) +
geom_line(aes(y = b1 + b6, colour = 'religion')) +
geom_line(aes(y = b1 + b2 + b4 + b6, colour = 'politics')) +
geom_line(aes(y = b1 + b3 + b5 + b6, colour = 'science')) +
scale_color_manual(name = "Legend", values = c('religion' = 'blue', 'politics' = 'red', 'science' = 'green'))+
labs(title = "Single-year", x = "Year", y = "Values")
ggsave("../output/results_1700_single.png")
ggplot(subset(betas, yr %in% seq(1500,1900,1)), aes(x = yr)) +
geom_line(aes(y = b1 + b6, colour = 'religion')) +
geom_line(aes(y = b1 + b2 + b4 + b6, colour = 'politics')) +
geom_line(aes(y = b1 + b3 + b5 + b6, colour = 'science')) +
scale_color_manual(name = "Legend", values = c('religion' = 'blue', 'politics' = 'red', 'science' = 'green'))+
labs(title = "Single-year", x = "Year", y = "Values")
ggsave("../output/results_full_single.png")
ggplot(subset(betas, yr %in% seq(1500,1900,1)), aes(x = yr)) +
geom_line(aes(y = b6, colour = 'time')) +
geom_line(aes(y = b4, colour = 'politics')) +
geom_line(aes(y = b5, colour = 'science')) +
scale_color_manual(name = "Legend", values = c('time' = 'blue', 'politics' = 'red', 'science' = 'green'))+
labs(title = "Single-year", x = "Year", y = "Values")
ggplot(subset(betas, yr %in% seq(1700,1900,1)), aes(x = yr)) +
geom_line(aes(y = b6, colour = 'time')) +
geom_line(aes(y = b4, colour = 'politics')) +
geom_line(aes(y = b5, colour = 'science')) +
scale_color_manual(name = "Legend", values = c('time' = 'blue', 'politics' = 'red', 'science' = 'green'))+
labs(title = "Single-year", x = "Year", y = "Values")
ggplot(subset(betas, yr %in% seq(1700,1900,1)), aes(x = yr)) +
geom_line(aes(y = b6, colour = 'time')) +
# geom_line(aes(y = b4, colour = 'politics')) +
# geom_line(aes(y = b5, colour = 'science')) +
scale_color_manual(name = "Legend", values = c('time' = 'blue', 'politics' = 'red', 'science' = 'green'))+
labs(title = "Single-year", x = "Year", y = "Values")
