# a <- list(mod1$bin_20)
#
# datasummary(list(bin_20) ~ estimate, data = mod1,
#             output = 'markdown')
mod1
s100 <- matrix(0, length(bins), 3)
View(s100)
colnames(s100) <- c("bin", "value", "std. error")
s100["bin"]
s100["bin",]
s100["bin",] <- bins
s100["bin"] <- bins
s100 <- matrix(0, length(bins), 3)
colnames(s100) <- c("bin", "value", "std. error")
s100[1] <- bins
View(s100)
s100[1] <- as_tibble(bins)
s100 <- as_tibble(matrix(0, length(bins), 3))
colnames(s100) <- c("bin", "value", "std. error")
s100 <- s100 %>%
mutate(bin = bins)
View(s100)
s100[1,2]
s100[2,1]
z <- volumes %>%
filter(bin_20 == 1530) %>%
lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics -Religion, data = .)
z <- volumes %>%
filter(bin_20 == 1630) %>%
lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics -Religion, data = .)
y <- lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics - Religion, data = volumes)
coefs <- coef(y)
covar <- vcov(y)
delt <- deltamethod(~ x1 + x2, coefs, covar)
coefs
coefs["Science"]
z <- volumes %>%
filter(bin_20 == 1630) %>%
lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics -Religion, data = .)
y <- lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics - Religion, data = volumes)
coefs <- coef(y)
covar <- vcov(y)
delt <- deltamethod(~ x1, coefs, covar)
summary(y)
s100 <- as_tibble(matrix(0, length(bins), 3))
colnames(s100) <- c("bin", "value", "std. error")
s100 <- s100 %>%
mutate(bin = bins)
for (i in 1:length(bins)){
betas <- coef(x[[i]])
covar <- vcov(x[[i]])
s100[i,2] <- betas["Science"]
s100[i,3] <- deltamethod(~ x2, betas, covar)
}
for (i in 1:length(bins)){
betas <- coef(mod1$x[[i]])
covar <- vcov(mod1$x[[i]])
s100[i,2] <- betas["Science"]
s100[i,3] <- deltamethod(~ x2, betas, covar)
}
View(s100)
mod1 <- volumes %>% group_by(bin_20) %>%
do(x = lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics - Religion, data = .))
for (i in 1:length(bins)){
betas <- coef(mod1$x[[i]])
covar <- vcov(mod1$x[[i]])
s100[i,2] <- betas["Science"]
s100[i,3] <- deltamethod(~ x2, betas, covar)
}
View(s100)
coefs["Science:Religion"]
s100 <- as_tibble(matrix(0, length(bins), 3))
colnames(s100) <- c("bin", "value", "std. error")
s100 <- s100 %>%
mutate(bin = bins)
s50p50 <- as_tibble(matrix(0, length(bins), 3))
colnames(s50p50) <- c("bin", "value", "std. error")
s50p50 <- s50p50 %>%
mutate(bin = bins)
for (i in 1:length(bins)){
betas <- coef(mod1$x[[i]])
covar <- vcov(mod1$x[[i]])
s100[i,2] <- betas["Science"]
s100[i,3] <- deltamethod(~ x2, betas, covar)
s50p50[i,2] <- betas["Science"]*.5 + betas["Science:Religion"]*.5
s50p50[i,3] <- deltamethod(~ x2*0.5 + x4*0.5, betas, covar)
}
View(s50p50)
volumes <- as.tibble(volumes)
#Regression by year
# mod1 <- volumes %>% group_by(bin_20) %>%
#   do(tidy(feols(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics, data = .)))
mod1 <- volumes %>% group_by(bin_20) %>%
do(x = lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics - Religion, data = .))
#Make empty dataframes
s100 <- as_tibble(matrix(0, length(bins), 3))
colnames(s100) <- c("bin", "value", "std. error")
s100 <- s100 %>%
mutate(bin = bins)
s50p50 <- as_tibble(matrix(0, length(bins), 3))
colnames(s50p50) <- c("bin", "value", "std. error")
s50p50 <- s50p50 %>%
mutate(bin = bins)
s50r50 <- as_tibble(matrix(0, length(bins), 3))
colnames(s50r50) <- c("bin", "value", "std. error")
s50r50 <- s50r50 %>%
mutate(bin = bins)
thirds <- as_tibble(matrix(0, length(bins), 3))
colnames(thirds) <- c("bin", "value", "std. error")
thirds <- thirds %>%
mutate(bin = bins)
for (i in 1:length(bins)){
betas <- coef(mod1$x[[i]])
covar <- vcov(mod1$x[[i]])
s100[i,2] <- betas["Science"]
s100[i,3] <- deltamethod(~ x2, betas, covar)
s50p50[i,2] <- betas["Science"]*0.5 + betas["Science:Religion"]*0.5
s50p50[i,3] <- deltamethod(~ x2*0.5 + x4*0.5, betas, covar)
s50r50[i,2] <- betas["Science"]*0.5 + betas["Science:Politics"]*0.5
s50r50[i,3] <- deltamethod(~ x2*0.5 + x5*0.5, betas, covar)
thirds[i,2] <- betas["Science"]*(1/3) + betas["Science:Religion"]*(1/3) + betas["Science:Politics"]*(1/3)
thirds[i,3] <- deltamethod(~ x2*(1/3) + x4*(1/3) + x5*(1/3), betas, covar)
}
#Not sure how to list results yet
# mod1 <- na.omit(mod1)
# modelsummary(mod1,
#              statistic = NULL,
#              output = "../output/marginal_effects.txt")
# mod1 <- data.frame(mod1)
# write.csv(mod1, file = '../output/marginal_effects.csv')
# a <- list(mod1$bin_20)
#
# datasummary(list(bin_20) ~ estimate, data = mod1,
#             output = 'markdown')
View(thirds)
View(thirds)
View(s100)
View(s50p50)
volumes <- as.tibble(volumes)
#Regression by year
# mod1 <- volumes %>% group_by(bin_20) %>%
#   do(tidy(feols(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics, data = .)))
mod1 <- volumes %>% group_by(bin_20) %>%
do(x = lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics - Religion, data = .))
#Make empty dataframes
s100 <- as_tibble(matrix(0, length(bins), 3))
colnames(s100) <- c("bin", "value", "std. error")
s100 <- s100 %>%
mutate(bin = bins)
s50p50 <- as_tibble(matrix(0, length(bins), 3))
colnames(s50p50) <- c("bin", "value", "std. error")
s50p50 <- s50p50 %>%
mutate(bin = bins)
s50r50 <- as_tibble(matrix(0, length(bins), 3))
colnames(s50r50) <- c("bin", "value", "std. error")
s50r50 <- s50r50 %>%
mutate(bin = bins)
thirds <- as_tibble(matrix(0, length(bins), 3))
colnames(thirds) <- c("bin", "value", "std. error")
thirds <- thirds %>%
mutate(bin = bins)
for (i in 1:length(bins)){
betas <- coef(mod1$x[[i]])
covar <- vcov(mod1$x[[i]])
s100[i,2] <- betas["Science"]
s100[i,3] <- deltamethod(~ x2, betas, covar)
s50r50[i,2] <- betas["Science"]*0.5 + betas["Science:Religion"]*0.5
s50r50[i,3] <- deltamethod(~ x2*0.5 + x4*0.5, betas, covar)
s50p50[i,2] <- betas["Science"]*0.5 + betas["Science:Politics"]*0.5
s50p50[i,3] <- deltamethod(~ x2*0.5 + x5*0.5, betas, covar)
thirds[i,2] <- betas["Science"]*(1/3) + betas["Science:Religion"]*(1/3) + betas["Science:Politics"]*(1/3)
thirds[i,3] <- deltamethod(~ x2*(1/3) + x4*(1/3) + x5*(1/3), betas, covar)
}
#Not sure how to list results yet
# mod1 <- na.omit(mod1)
# modelsummary(mod1,
#              statistic = NULL,
#              output = "../output/marginal_effects.txt")
# mod1 <- data.frame(mod1)
# write.csv(mod1, file = '../output/marginal_effects.csv')
# a <- list(mod1$bin_20)
#
# datasummary(list(bin_20) ~ estimate, data = mod1,
#             output = 'markdown')
View(s50p50)
View(s50r50)
View(thirds)
View(s100)
rm(list=ls())
options(scipen=999)
library(tidyverse)
library(fixest)
library(data.table)
library(broom)
library(modelsummary)
library(msm)
volumes <- read.csv("../input/volumes_all_opt_percentile.csv")
volumes <- volumes[,-1] #Drops 'X' which is just the index attached by Python
years <- seq(1510,1890, by=1)
bins <- seq(1610, 1890, by = 20)
#Merge volume years to closest bin
a = data.table(Value=volumes$Year_rounded) #Extract years
a[,merge:=Value] #Give data.table something to merge on
b = data.table(Value = bins)
b[,merge:=Value]
setkeyv(a, c('merge')) #Sort for quicker merge
setkeyv(b, c('merge'))
rounded = b[a, roll='nearest'] #Merge to nearest
rounded <- distinct(rounded) #Get distinct values for easier merge to 'volumes'
# volumes <- data.table(volumes)
volumes <- merge(volumes, rounded, by.x = "Year_rounded", by.y = "merge")
#Remove unnecessary column
volumes <- volumes %>%
subset(select = -c(i.Value)) %>%
rename(bin_20 = Value)
volumes <- as.tibble(volumes)
#Regression by year
# mod1 <- volumes %>% group_by(bin_20) %>%
#   do(tidy(feols(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics, data = .)))
mod1 <- volumes %>% group_by(bin_20) %>%
do(x = lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics - Religion, data = .))
#Make empty dataframes
s100 <- as_tibble(matrix(0, length(bins), 3))
colnames(s100) <- c("bin", "value", "std. error")
s100 <- s100 %>%
mutate(bin = bins)
s50p50 <- as_tibble(matrix(0, length(bins), 3))
colnames(s50p50) <- c("bin", "value", "std. error")
s50p50 <- s50p50 %>%
mutate(bin = bins)
s50r50 <- as_tibble(matrix(0, length(bins), 3))
colnames(s50r50) <- c("bin", "value", "std. error")
s50r50 <- s50r50 %>%
mutate(bin = bins)
thirds <- as_tibble(matrix(0, length(bins), 3))
colnames(thirds) <- c("bin", "value", "std. error")
thirds <- thirds %>%
mutate(bin = bins)
for (i in 1:length(bins)){
betas <- coef(mod1$x[[i]])
covar <- vcov(mod1$x[[i]])
s100[i,2] <- betas["Science"]
s100[i,3] <- deltamethod(~ x2, betas, covar)
s50r50[i,2] <- betas["Science"]*0.5 + betas["Science:Religion"]*0.5
s50r50[i,3] <- deltamethod(~ x2*0.5 + x4*0.5, betas, covar)
s50p50[i,2] <- betas["Science"]*0.5 + betas["Science:Politics"]*0.5
s50p50[i,3] <- deltamethod(~ x2*0.5 + x5*0.5, betas, covar)
thirds[i,2] <- betas["Science"]*(1/3) + betas["Science:Religion"]*(1/3) + betas["Science:Politics"]*(1/3)
thirds[i,3] <- deltamethod(~ x2*(1/3) + x4*(1/3) + x5*(1/3), betas, covar)
}
#Not sure how to list results yet
# mod1 <- na.omit(mod1)
# modelsummary(mod1,
#              statistic = NULL,
#              output = "../output/marginal_effects.txt")
# mod1 <- data.frame(mod1)
# write.csv(mod1, file = '../output/marginal_effects.csv')
# a <- list(mod1$bin_20)
#
# datasummary(list(bin_20) ~ estimate, data = mod1,
#             output = 'markdown')
View(s100)
z <- volumes %>%
filter(bin_20 == 1630) %>%
lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics -Religion, data = .)
y <- lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics - Religion, data = volumes)
coefs <- coef(y)
covar <- vcov(y)
delt <- deltamethod(~ x1, coefs, covar)
?predict
z <- volumes %>%
filter(bin_20 == 1630) %>%
lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics -Religion, data = .)
y <- lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics - Religion, data = volumes)
coefs <- coef(y)
covar <- vcov(y)
delt <- deltamethod(~ x1, coefs, covar)
data <- data.frame(Science = .25, Politics = .25, Religion = 0.5)
predition <- predict(z, newdata = data, interval = "confidence", se.fit = TRUE)
z <- volumes %>%
filter(bin_20 == 1630) %>%
lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics -Religion, data = .)
y <- lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics - Religion, data = volumes)
coefs <- coef(y)
covar <- vcov(y)
delt <- deltamethod(~ x1, coefs, covar)
data <- data.frame(Science = .25, Politics = .25, Religion = 0.5)
prediction <- predict(z, newdata = data, interval = "confidence", se.fit = TRUE)
prediction$fit
pred <- function(lm, sci, pol, rel){
data <- data.frame(Science = sci, Politics = pol, Religion = rel)
prediction <- predict(lm, newdata = data, interval = "confidence", se.fit =TRUE)
value <- c(prediction$fit[1], prediction$fit[2], prediction$fit[3], prediction$se.fit)
return(value)
}
pred(z, .25, .25, 0.5)
z <- volumes %>%
filter(bin_20 == 1630) %>%
lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics -Religion, data = .)
y <- lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics - Religion, data = volumes)
coefs <- coef(y)
covar <- vcov(y)
delt <- deltamethod(~ x1, coefs, covar)
data <- data.frame(Science = .25, Politics = .25, Religion = 0.5)
prediction <- pred(z, .25, .25, 0.5)
prediction[1]
s100 <- as_tibble(matrix(0, length(bins), 7))
colnames(s100) <- c("bin", "marginal", "std. error", "y_hat", "lower", "upper", "se_fit")
s100 <- s100 %>%
mutate(bin = bins)
s100[2,1:7]
volumes <- as.tibble(volumes)
#Regression by year
# mod1 <- volumes %>% group_by(bin_20) %>%
#   do(tidy(feols(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics, data = .)))
mod1 <- volumes %>% group_by(bin_20) %>%
do(x = lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics - Religion, data = .))
#Make empty dataframes
s100 <- as_tibble(matrix(0, length(bins), 7))
colnames(s100) <- c("bin", "marginal", "std. error", "y_hat", "lower", "upper", "se_fit")
s100 <- s100 %>%
mutate(bin = bins)
s50p50 <- as_tibble(matrix(0, length(bins), 3))
colnames(s50p50) <-  c("bin", "marginal", "std. error", "y_hat", "lower", "upper", "se_fit")
s50p50 <- s50p50 %>%
mutate(bin = bins)
s50r50 <- as_tibble(matrix(0, length(bins), 3))
colnames(s50r50) <-  c("bin", "marginal", "std. error", "y_hat", "lower", "upper", "se_fit")
s50r50 <- s50r50 %>%
mutate(bin = bins)
thirds <- as_tibble(matrix(0, length(bins), 3))
colnames(thirds) <-  c("bin", "marginal", "std. error", "y_hat", "lower", "upper", "se_fit")
thirds <- thirds %>%
mutate(bin = bins)
pred <- function(lm, sci, pol, rel){
data <- data.frame(Science = sci, Politics = pol, Religion = rel)
prediction <- predict(lm, newdata = data, interval = "confidence", se.fit =TRUE)
value <- c(prediction$fit[1], prediction$fit[2], prediction$fit[3], prediction$se.fit)
return(value)
}
for (i in 1:length(bins)){
betas <- coef(mod1$x[[i]])
covar <- vcov(mod1$x[[i]])
s100[i,2] <- betas["Science"]
s100[i,3] <- deltamethod(~ x2, betas, covar)
#Predict
s100[i,4:7] <- pred(mod1$x[[i]], 1, 0, 0)
s50r50[i,2] <- betas["Science"]*0.5 + betas["Science:Religion"]*0.5
s50r50[i,3] <- deltamethod(~ x2*0.5 + x4*0.5, betas, covar)
s50p50[i,2] <- betas["Science"]*0.5 + betas["Science:Politics"]*0.5
s50p50[i,3] <- deltamethod(~ x2*0.5 + x5*0.5, betas, covar)
thirds[i,2] <- betas["Science"]*(1/3) + betas["Science:Religion"]*(1/3) + betas["Science:Politics"]*(1/3)
thirds[i,3] <- deltamethod(~ x2*(1/3) + x4*(1/3) + x5*(1/3), betas, covar)
}
volumes <- as.tibble(volumes)
#Regression by year
# mod1 <- volumes %>% group_by(bin_20) %>%
#   do(tidy(feols(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics, data = .)))
mod1 <- volumes %>% group_by(bin_20) %>%
do(x = lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics - Religion, data = .))
#Make empty dataframes
s100 <- as_tibble(matrix(0, length(bins), 7))
colnames(s100) <- c("bin", "marginal", "std. error", "y_hat", "lower", "upper", "se_fit")
s100 <- s100 %>%
mutate(bin = bins)
s50p50 <- as_tibble(matrix(0, length(bins), 3))
colnames(s50p50) <-  c("bin", "marginal", "std. error", "y_hat", "lower", "upper", "se_fit")
s50p50 <- s50p50 %>%
mutate(bin = bins)
s50r50 <- as_tibble(matrix(0, length(bins), 3))
colnames(s50r50) <-  c("bin", "marginal", "std. error", "y_hat", "lower", "upper", "se_fit")
s50r50 <- s50r50 %>%
mutate(bin = bins)
thirds <- as_tibble(matrix(0, length(bins), 3))
colnames(thirds) <-  c("bin", "marginal", "std. error", "y_hat", "lower", "upper", "se_fit")
thirds <- thirds %>%
mutate(bin = bins)
pred <- function(lm, sci, pol, rel){
data <- data.frame(Science = sci, Politics = pol, Religion = rel)
prediction <- predict(lm, newdata = data, interval = "confidence", se.fit =TRUE)
value <- c(prediction$fit[1], prediction$fit[2], prediction$fit[3], prediction$se.fit)
return(value)
}
for (i in 1:length(bins)){
betas <- coef(mod1$x[[i]])
covar <- vcov(mod1$x[[i]])
s100[i,2] <- betas["Science"]
s100[i,3] <- deltamethod(~ x2, betas, covar)
#Predict
s100[i,4:7] <- list(pred(mod1$x[[i]], 1, 0, 0))
s50r50[i,2] <- betas["Science"]*0.5 + betas["Science:Religion"]*0.5
s50r50[i,3] <- deltamethod(~ x2*0.5 + x4*0.5, betas, covar)
s50p50[i,2] <- betas["Science"]*0.5 + betas["Science:Politics"]*0.5
s50p50[i,3] <- deltamethod(~ x2*0.5 + x5*0.5, betas, covar)
thirds[i,2] <- betas["Science"]*(1/3) + betas["Science:Religion"]*(1/3) + betas["Science:Politics"]*(1/3)
thirds[i,3] <- deltamethod(~ x2*(1/3) + x4*(1/3) + x5*(1/3), betas, covar)
}
volumes <- as.tibble(volumes)
#Regression by year
# mod1 <- volumes %>% group_by(bin_20) %>%
#   do(tidy(feols(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics, data = .)))
mod1 <- volumes %>% group_by(bin_20) %>%
do(x = lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics - Religion, data = .))
#Make empty dataframes
s100 <- as_tibble(matrix(0, length(bins), 7))
colnames(s100) <- c("bin", "marginal", "std. error", "y_hat", "lower", "upper", "se_fit")
s100 <- s100 %>%
mutate(bin = bins)
s50p50 <- as_tibble(matrix(0, length(bins), 3))
colnames(s50p50) <-  c("bin", "marginal", "std. error", "y_hat", "lower", "upper", "se_fit")
s50p50 <- s50p50 %>%
mutate(bin = bins)
s50r50 <- as_tibble(matrix(0, length(bins), 3))
colnames(s50r50) <-  c("bin", "marginal", "std. error", "y_hat", "lower", "upper", "se_fit")
s50r50 <- s50r50 %>%
mutate(bin = bins)
thirds <- as_tibble(matrix(0, length(bins), 3))
colnames(thirds) <-  c("bin", "marginal", "std. error", "y_hat", "lower", "upper", "se_fit")
thirds <- thirds %>%
mutate(bin = bins)
pred <- function(lm, sci, pol, rel){
data <- data.frame(Science = sci, Politics = pol, Religion = rel)
prediction <- predict(lm, newdata = data, interval = "confidence", se.fit =TRUE)
value <- c(prediction$fit[1], prediction$fit[2], prediction$fit[3], prediction$se.fit)
return(value)
}
for (i in 1:length(bins)){
betas <- coef(mod1$x[[i]])
covar <- vcov(mod1$x[[i]])
s100[i,2] <- betas["Science"]
s100[i,3] <- deltamethod(~ x2, betas, covar)
#Predict
s100[i,4:7] <- as.list(pred(mod1$x[[i]], 1, 0, 0))
s50r50[i,2] <- betas["Science"]*0.5 + betas["Science:Religion"]*0.5
s50r50[i,3] <- deltamethod(~ x2*0.5 + x4*0.5, betas, covar)
s50p50[i,2] <- betas["Science"]*0.5 + betas["Science:Politics"]*0.5
s50p50[i,3] <- deltamethod(~ x2*0.5 + x5*0.5, betas, covar)
thirds[i,2] <- betas["Science"]*(1/3) + betas["Science:Religion"]*(1/3) + betas["Science:Politics"]*(1/3)
thirds[i,3] <- deltamethod(~ x2*(1/3) + x4*(1/3) + x5*(1/3), betas, covar)
}
#Not sure how to list results yet
# mod1 <- na.omit(mod1)
# modelsummary(mod1,
#              statistic = NULL,
#              output = "../output/marginal_effects.txt")
# mod1 <- data.frame(mod1)
# write.csv(mod1, file = '../output/marginal_effects.csv')
# a <- list(mod1$bin_20)
#
# datasummary(list(bin_20) ~ estimate, data = mod1,
#             output = 'markdown')
View(s100)
volumes <- as.tibble(volumes)
#Regression by year
# mod1 <- volumes %>% group_by(bin_20) %>%
#   do(tidy(feols(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics, data = .)))
mod1 <- volumes %>% group_by(bin_20) %>%
do(x = lm(Percentile ~ Science + Politics + Science*Religion + Science*Politics + Religion*Politics - Religion, data = .))
#Make empty dataframes
s100 <- as_tibble(matrix(0, length(bins), 7))
colnames(s100) <- c("bin", "marginal", "std. error", "y_hat", "lower", "upper", "se_fit")
s100 <- s100 %>%
mutate(bin = bins)
s50p50 <- as_tibble(matrix(0, length(bins), 7))
colnames(s50p50) <-  c("bin", "marginal", "std. error", "y_hat", "lower", "upper", "se_fit")
s50p50 <- s50p50 %>%
mutate(bin = bins)
s50r50 <- as_tibble(matrix(0, length(bins), 7))
colnames(s50r50) <-  c("bin", "marginal", "std. error", "y_hat", "lower", "upper", "se_fit")
s50r50 <- s50r50 %>%
mutate(bin = bins)
thirds <- as_tibble(matrix(0, length(bins), 7))
colnames(thirds) <-  c("bin", "marginal", "std. error", "y_hat", "lower", "upper", "se_fit")
thirds <- thirds %>%
mutate(bin = bins)
pred <- function(lm, sci, pol, rel){
data <- data.frame(Science = sci, Politics = pol, Religion = rel)
prediction <- predict(lm, newdata = data, interval = "confidence", se.fit =TRUE)
value <- c(prediction$fit[1], prediction$fit[2], prediction$fit[3], prediction$se.fit)
return(value)
}
for (i in 1:length(bins)){
betas <- coef(mod1$x[[i]])
covar <- vcov(mod1$x[[i]])
s100[i,2] <- betas["Science"]
s100[i,3] <- deltamethod(~ x2, betas, covar)
s100[i,4:7] <- as.list(pred(mod1$x[[i]], 1, 0, 0))
s50r50[i,2] <- betas["Science"]*0.5 + betas["Science:Religion"]*0.5
s50r50[i,3] <- deltamethod(~ x2*0.5 + x4*0.5, betas, covar)
s50r50[i,4:7] <- as.list(pred(mod1$x[[i]], 0.5, 0 ,0.5))
s50p50[i,2] <- betas["Science"]*0.5 + betas["Science:Politics"]*0.5
s50p50[i,3] <- deltamethod(~ x2*0.5 + x5*0.5, betas, covar)
s50p50[i,4:7] <- as.list(pred(mod1$x[[i]], 0.5, 0.5, 0))
thirds[i,2] <- betas["Science"]*(1/3) + betas["Science:Religion"]*(1/3) + betas["Science:Politics"]*(1/3)
thirds[i,3] <- deltamethod(~ x2*(1/3) + x4*(1/3) + x5*(1/3), betas, covar)
thirds[i,4:7] <- as.list(pred(mod1$x[[i]], (1/3), (1/3), (1/3)))
}
#Not sure how to list results yet
# mod1 <- na.omit(mod1)
# modelsummary(mod1,
#              statistic = NULL,
#              output = "../output/marginal_effects.txt")
# mod1 <- data.frame(mod1)
# write.csv(mod1, file = '../output/marginal_effects.csv')
# a <- list(mod1$bin_20)
#
# datasummary(list(bin_20) ~ estimate, data = mod1,
#             output = 'markdown')
View(thirds)
View(s50p50)
View(s50r50)
View(s50p50)
