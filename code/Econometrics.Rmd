---
title: "Econometrics"
author: "Austin Kennedy"
date: "1/29/2022"
output: html_document
---

```{r Clear memory and setup}
rm(list=ls())
options(scipen=999)
```


```{r Packages}
library(tidyverse)
```

```{r Load Data}
volumes <- read.csv("../input/volumes_all_opt_percentile.csv")
```

```{r Clean up}
volumes <- volumes[,-1] #Drops 'X' which is just the index attached by Python
```

```{r Create years}
years <- seq(1510,1890, by=1)
```

```{r Create Year Dummies}
#Create empty data frame with row dimension same as 'volumes', column dimension 'years'
#Column names are 
year_dummies <- data.frame(matrix(0, nrow = nrow(volumes), ncol = length(years),
                  dimnames = list(NULL, paste0("x", years[1]:years[length(years)]))))

#Populate with dummies
for (i in 1:length(years)){
  year <- years[i]
  year_dummies[i] <- ifelse(volumes$Year_rounded >= (year - 10) & volumes$Year_rounded <= (year + 10), 1, 0)
}
```

```{r Create interactions}
sci_year <- volumes$Science*year_dummies
pol_year <- volumes$Politics*year_dummies

#Rename column names, regression cannot have repeated col names
names(sci_year) <- gsub("x", "s", names(sci_year), fixed=TRUE) 
names(pol_year) <- gsub("x", "p", names(pol_year), fixed=TRUE)
# sci_year %>% rename_with( ~ paste0())
```

```{r Merge data}
df <- cbind(volumes, year_dummies, sci_year, pol_year)
```

```{r Regression}
model <- lm(Percentile ~. - Year_rounded - Optimism - Religion, data = df)
summary(model)
```

```{r Get coefficients}
library(broom)
results <- tidy(model)

a1 <- results %>% filter(term == "(Intercept)") %>% pull(estimate)
a2 <- results %>% filter(term == "Politics") %>% pull(estimate)
a3 <- results %>% filter(term == "Science") %>% pull(estimate)
a4 <- results %>% filter(substr(term, 1, 1) == "p") %>% pull(estimate)
a5 <- results %>% filter(substr(term, 1, 1) == "s") %>% pull(estimate)
a6 <- results %>% filter(substr(term, 1, 1) == "x") %>% pull(estimate)

a1 <- rep(a1, length(a4))
a2 <- rep(a2, length(a4))
a3 <- rep(a3, length(a4))

test <- as_tibble(cbind(a1, a2, a3, a4, a5, a6))
```

```{r Test code}
results <- as_tibble(c(coef(model,  )))
results <- as_tibble(coef(summary(model, complete=TRUE)))

library(broom)
results <- tidy(model)

a1 <- results %>% filter(term == "(Intercept)")
a2 <- results %>% filter(term == "Politics")
a3 <- results %>% filter(term == "Science")
a4 <- results %>% filter(substr(term, 1, 1) == "p")
a5 <- results %>% filter(substr(term, 1, 1) == "s")
a6 <- results %>% filter(substr(term, 1, 1) == "x")

fit <- lm(Percentile ~ x1510, data=df)
summary(fit)
df %>% group_by(x1513) %>%
  tally()
```









